{% extends "base.html" %}

{% block title %}Dashboard - {{ data.username }}{% endblock %}

{% block head_extra %}
    {# Add Socket.IO client library #}
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    {# Link dashboard-specific CSS if needed #}
    {# <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"> #}
{% endblock %}

{% block content %}
<div class="dashboard-layout">
    {# --- Left Sidebar --- #}
    <aside class="sidebar">
        <nav class="sidebar-nav">
            {# AI Agents Section (Expandable) #}
            <details class="sidebar-section" open> {# Starts open #}
                <summary class="sidebar-section-title">ü§ñ AI Agents</summary>
                <ul class="sidebar-submenu">
                    <li><a href="#" data-content="education">Education Agent</a></li>
                    <li><a href="#" data-content="healthcare">Healthcare Agent</a></li>
                    <li><a href="#" data-content="construction">Construction Agent</a></li>
                    <li><a href="#" data-content="law">Law Agent</a></li>
                    <li><a href="#" data-content="rnd">Science & R&D Agent</a></li>
                    <li><a href="#" data-content="other_agents">Other Agents</a></li>
                    <li><a href="#" data-content="view_constructor">View Constructor</a></li> {# Specific request #}
                </ul>
            </details>

            {# Services Section (Expandable) #}
            <details class="sidebar-section">
                <summary class="sidebar-section-title">‚öôÔ∏è Services</summary>
                <ul class="sidebar-submenu">
                    {% for service in data.services %}
                    <li><a href="#" data-content="service-{{ loop.index }}">{{ service }}</a></li>
                    {% endfor %}
                </ul>
            </details>

             {# Integrated Apps Section (Expandable) #}
            <details class="sidebar-section">
                <summary class="sidebar-section-title">üí° Integrated Apps</summary>
                 <ul class="sidebar-submenu">
                    {% for app in data.apps %}
                    <li><a href="#" data-content="app-{{ app.id }}">{{ app.name }}</a></li>
                    {% endfor %}
                </ul>
            </details>

            {# Account Section (Expandable) #}
            <details class="sidebar-section">
                <summary class="sidebar-section-title">üë§ Account</summary>
                <ul class="sidebar-submenu">
                    <li><a href="#" data-content="change-password">Change Password</a></li> {# Link to functionality TBD #}
                    <li><a href="#" data-content="view-profile">View Profile</a></li> {# Link to functionality TBD #}
                    <li><a href="{{ url_for('logout') }}">Logout</a></li> {# Direct logout link #}
                </ul>
            </details>
        </nav>
    </aside>

    {# --- Main Dashboard Content Area --- #}
    <section class="main-dashboard-content">
        <h2>Dashboard Overview üìä</h2>
        <p>Welcome back, <strong>{{ data.username }}</strong>! Select an option from the sidebar to get started.</p>

        {# Area where content loaded by sidebar clicks will appear #}
        <div id="dashboard-dynamic-content" class="dynamic-content-area">
            <p><i>Content for the selected sidebar item will load here.</i></p>
             {# Example placeholder sections - these would be shown/hidden by JS #}
             <div id="content-education" class="content-panel" style="display: none;"><h3>Education Agent</h3><p>Tools and features for educational analysis...</p></div>
             <div id="content-healthcare" class="content-panel" style="display: none;"><h3>Healthcare Agent</h3><p>Tools and features for healthcare data...</p></div>
             <div id="content-app-tts" class="content-panel" style="display: none;"><h3>Text-to-Speech App</h3><p>Controls for TTS...</p></div>
             <div id="content-change-password" class="content-panel" style="display: none;"><h3>Change Password</h3><p>Form to change password will go here...</p></div>
             {# Add placeholders for other data-content values #}
        </div>

        {# --- Dashboard General Chat Section --- #}
        <section class="dashboard-section dashboard-chat-section" id="chat-section">
            <h3>General Chat üí¨</h3>
            <div id="dashboardChatMessages" class="chat-messages">
                <div class="message system">Connecting to chat...</div>
            </div>
            <div id="dashboardTypingIndicator" class="typing-indicator" style="display: none;">
                <span></span><span></span><span></span> AI is thinking...
            </div>
            <div class="chat-input-area">
                <input type="text" id="dashboardChatInput" placeholder="Ask a general question..." disabled>
                <button id="sendDashboardChatBtn" class="btn btn-secondary" disabled>Send</button>
            </div>
             <div id="chatError" class="error-message" style="display: none;"></div>
        </section>
    </section> {# End main-dashboard-content #}

</div> {# End dashboard-layout #}
{% endblock %}

{% block scripts %}
    {# Link the specific JavaScript for the dashboard page #}
    <script type="module" src="{{ url_for('static', filename='script.js') }}"></script>
{% endblock %}